cmake_minimum_required(VERSION 3.0)
project(khttpd)
file(GLOB KHTTPD_SOURCE_FILES  ${CMAKE_CURRENT_SOURCE_DIR}/../src/*.cpp)
file(GLOB KHTTPD_INCLUDE_FILES ${CMAKE_CURRENT_SOURCE_DIR}/../include/*.h)

if (NOT KASYNC_DIR) 
 message(FATAL "config -DKASYNC_DIR")
endif()
set(KHTTPD_INCLUDE_DIR ${CMAKE_CURRENT_SOURCE_DIR}/../include)
list(APPEND KHTTPD_INCLUDE_DIR ${KASYNC_DIR}/include)
include(CheckSymbolExists)
check_symbol_exists(KSOCKET_SSL ${KASYNC_DIR}/include/kasync_config.h HAVE_KSOCKET_SSL)
if (HAVE_KSOCKET_SSL)
    include(FindOpenSSL)
    if (NOT OPENSSL_FOUND)
        message(FATAL_ERROR "cann't found ssl")
    endif() 
   # list(APPEND KANGLE_LIBS  OpenSSL::SSL OpenSSL::Crypto)
    list(APPEND KHTTPD_INCLUDE_DIR ${OPENSSL_INCLUDE_DIR}) 
endif()
add_library(khttpd STATIC ${KHTTPD_SOURCE_FILES} ${KASYNC_INCLUDE_FILES})
target_include_directories(khttpd PUBLIC ${KHTTPD_INCLUDE_DIR})
